{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Rehman/Downloads/Ma%20Bags/src/lib/mongodb.ts"],"sourcesContent":["import { MongoClient, type Db } from \"mongodb\"\n\nconst uri = process.env.MONGODB_URI || \"\"\nconst options = {}\n\nlet client: MongoClient | null = null\nlet clientPromise: Promise<MongoClient> | null = null\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var _mongoClientPromise: Promise<MongoClient> | undefined\n}\n\nfunction getClientPromise(): Promise<MongoClient> {\n  if (!uri || !uri.startsWith(\"mongodb\")) {\n    throw new Error(\n      \"Please add your MongoDB URI to .env.local. Get your connection string from MongoDB Atlas (https://cloud.mongodb.com)\"\n    )\n  }\n\n  if (process.env.NODE_ENV === \"development\") {\n    // In development mode, use a global variable to preserve the connection\n    if (!global._mongoClientPromise) {\n      client = new MongoClient(uri, options)\n      global._mongoClientPromise = client.connect()\n    }\n    return global._mongoClientPromise\n  } else {\n    // In production, create a new client for each request\n    if (!clientPromise) {\n      client = new MongoClient(uri, options)\n      clientPromise = client.connect()\n    }\n    return clientPromise\n  }\n}\n\nexport async function getDatabase(): Promise<Db> {\n  const client = await getClientPromise()\n  return client.db(\"mabags\")\n}\n\nexport default getClientPromise\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW,IAAI;AACvC,MAAM,UAAU,CAAC;AAEjB,IAAI,SAA6B;AACjC,IAAI,gBAA6C;AAOjD,SAAS;IACP,IAAI,CAAC,OAAO,CAAC,IAAI,UAAU,CAAC,YAAY;QACtC,MAAM,IAAI,MACR;IAEJ;IAEA,wCAA4C;QAC1C,wEAAwE;QACxE,IAAI,CAAC,OAAO,mBAAmB,EAAE;YAC/B,SAAS,IAAI,sHAAW,CAAC,KAAK;YAC9B,OAAO,mBAAmB,GAAG,OAAO,OAAO;QAC7C;QACA,OAAO,OAAO,mBAAmB;IACnC;;AAQF;AAEO,eAAe;IACpB,MAAM,SAAS,MAAM;IACrB,OAAO,OAAO,EAAE,CAAC;AACnB;uCAEe"}},
    {"offset": {"line": 87, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Rehman/Downloads/Ma%20Bags/app/api/products/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\r\nimport { getDatabase } from \"@/lib/mongodb\"\r\nimport type { Product, ProductFilters, PaginatedResponse, ApiResponse } from \"@/lib/types\"\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const searchParams = request.nextUrl.searchParams\r\n    const category = searchParams.get(\"category\")\r\n    const search = searchParams.get(\"search\")\r\n    const featured = searchParams.get(\"featured\") === \"true\"\r\n    const inStock = searchParams.get(\"inStock\")\r\n    const minPrice = searchParams.get(\"minPrice\")\r\n    const maxPrice = searchParams.get(\"maxPrice\")\r\n    const sort = searchParams.get(\"sort\") || \"newest\"\r\n    const page = Number.parseInt(searchParams.get(\"page\") || \"1\", 10)\r\n    const limit = Number.parseInt(searchParams.get(\"limit\") || \"12\", 10)\r\n\r\n    const db = await getDatabase()\r\n    const productsCollection = db.collection<Product>(\"products\")\r\n\r\n    // Build filter query\r\n    const filter: any = {}\r\n\r\n    if (category) {\r\n      filter.categories = category\r\n    }\r\n\r\n    if (search) {\r\n      filter.$or = [\r\n        { title: { $regex: search, $options: \"i\" } },\r\n        { description: { $regex: search, $options: \"i\" } },\r\n      ]\r\n    }\r\n\r\n    if (featured) {\r\n      filter.isFeatured = true\r\n    }\r\n\r\n    if (inStock !== null && inStock !== undefined) {\r\n      filter.inStock = inStock === \"true\"\r\n    }\r\n\r\n    if (minPrice || maxPrice) {\r\n      filter.price = {}\r\n      if (minPrice) filter.price.$gte = Number.parseFloat(minPrice)\r\n      if (maxPrice) filter.price.$lte = Number.parseFloat(maxPrice)\r\n    }\r\n\r\n    // Build sort query\r\n    let sortQuery: any = {}\r\n    switch (sort) {\r\n      case \"price-asc\":\r\n        sortQuery = { price: 1 }\r\n        break\r\n      case \"price-desc\":\r\n        sortQuery = { price: -1 }\r\n        break\r\n      case \"name\":\r\n        sortQuery = { title: 1 }\r\n        break\r\n      case \"oldest\":\r\n        sortQuery = { createdAt: 1 }\r\n        break\r\n      case \"newest\":\r\n      default:\r\n        sortQuery = { createdAt: -1 }\r\n        break\r\n    }\r\n\r\n    // Get total count\r\n    const total = await productsCollection.countDocuments(filter)\r\n\r\n    // Get paginated results\r\n    const skip = (page - 1) * limit\r\n    const items = await productsCollection\r\n      .find(filter)\r\n      .sort(sortQuery)\r\n      .skip(skip)\r\n      .limit(limit)\r\n      .toArray()\r\n\r\n    // Convert ObjectId to string\r\n    const products = items.map((item) => ({\r\n      ...item,\r\n      _id: item._id?.toString(),\r\n    }))\r\n\r\n    const totalPages = Math.ceil(total / limit)\r\n    const hasMore = page < totalPages\r\n\r\n    const response: PaginatedResponse<Product> = {\r\n      items: products,\r\n      total,\r\n      page,\r\n      totalPages,\r\n      hasMore,\r\n    }\r\n\r\n    return NextResponse.json<ApiResponse<PaginatedResponse<Product>>>({\r\n      success: true,\r\n      data: response,\r\n    })\r\n  } catch (error) {\r\n    console.error(\"Error fetching products:\", error)\r\n    return NextResponse.json<ApiResponse>(\r\n      {\r\n        success: false,\r\n        error: \"Failed to fetch products\",\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,eAAe,QAAQ,OAAO,CAAC,YAAY;QACjD,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,WAAW,aAAa,GAAG,CAAC,gBAAgB;QAClD,MAAM,UAAU,aAAa,GAAG,CAAC;QACjC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,OAAO,aAAa,GAAG,CAAC,WAAW;QACzC,MAAM,OAAO,OAAO,QAAQ,CAAC,aAAa,GAAG,CAAC,WAAW,KAAK;QAC9D,MAAM,QAAQ,OAAO,QAAQ,CAAC,aAAa,GAAG,CAAC,YAAY,MAAM;QAEjE,MAAM,KAAK,MAAM,IAAA,sIAAW;QAC5B,MAAM,qBAAqB,GAAG,UAAU,CAAU;QAElD,qBAAqB;QACrB,MAAM,SAAc,CAAC;QAErB,IAAI,UAAU;YACZ,OAAO,UAAU,GAAG;QACtB;QAEA,IAAI,QAAQ;YACV,OAAO,GAAG,GAAG;gBACX;oBAAE,OAAO;wBAAE,QAAQ;wBAAQ,UAAU;oBAAI;gBAAE;gBAC3C;oBAAE,aAAa;wBAAE,QAAQ;wBAAQ,UAAU;oBAAI;gBAAE;aAClD;QACH;QAEA,IAAI,UAAU;YACZ,OAAO,UAAU,GAAG;QACtB;QAEA,IAAI,YAAY,QAAQ,YAAY,WAAW;YAC7C,OAAO,OAAO,GAAG,YAAY;QAC/B;QAEA,IAAI,YAAY,UAAU;YACxB,OAAO,KAAK,GAAG,CAAC;YAChB,IAAI,UAAU,OAAO,KAAK,CAAC,IAAI,GAAG,OAAO,UAAU,CAAC;YACpD,IAAI,UAAU,OAAO,KAAK,CAAC,IAAI,GAAG,OAAO,UAAU,CAAC;QACtD;QAEA,mBAAmB;QACnB,IAAI,YAAiB,CAAC;QACtB,OAAQ;YACN,KAAK;gBACH,YAAY;oBAAE,OAAO;gBAAE;gBACvB;YACF,KAAK;gBACH,YAAY;oBAAE,OAAO,CAAC;gBAAE;gBACxB;YACF,KAAK;gBACH,YAAY;oBAAE,OAAO;gBAAE;gBACvB;YACF,KAAK;gBACH,YAAY;oBAAE,WAAW;gBAAE;gBAC3B;YACF,KAAK;YACL;gBACE,YAAY;oBAAE,WAAW,CAAC;gBAAE;gBAC5B;QACJ;QAEA,kBAAkB;QAClB,MAAM,QAAQ,MAAM,mBAAmB,cAAc,CAAC;QAEtD,wBAAwB;QACxB,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAC1B,MAAM,QAAQ,MAAM,mBACjB,IAAI,CAAC,QACL,IAAI,CAAC,WACL,IAAI,CAAC,MACL,KAAK,CAAC,OACN,OAAO;QAEV,6BAA6B;QAC7B,MAAM,WAAW,MAAM,GAAG,CAAC,CAAC,OAAS,CAAC;gBACpC,GAAG,IAAI;gBACP,KAAK,KAAK,GAAG,EAAE;YACjB,CAAC;QAED,MAAM,aAAa,KAAK,IAAI,CAAC,QAAQ;QACrC,MAAM,UAAU,OAAO;QAEvB,MAAM,WAAuC;YAC3C,OAAO;YACP;YACA;YACA;YACA;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAA0C;YAChE,SAAS;YACT,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;QACT,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}